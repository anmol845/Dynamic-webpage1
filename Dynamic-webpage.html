<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic Page — Demo</title>
  <style>
  
    :root{--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--accent:#2563eb}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:#0f172a}
    header{background:linear-gradient(90deg,#ffffffcc, #f8fafc);backdrop-filter: blur(4px);padding:18px 20px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:40;border-bottom:1px solid #e6edf7}
    .logo{font-weight:700;color:var(--accent)}
    .searchbar{flex:1;display:flex;gap:8px}
    .searchbar input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #dbe7ff;background:white}
    .controls{display:flex;gap:8px}
    .btn{padding:9px 12px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer}
    main{max-width:1100px;margin:24px auto;padding:0 20px}
    .hero{display:grid;grid-template-columns:1fr 300px;gap:18px;align-items:center;margin-bottom:20px}
    .hero-card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(13,38,76,0.06)}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .select, .chip{padding:8px 10px;border-radius:8px;border:1px solid #e6edf7;background:white}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:var(--card);padding:12px;border-radius:12px;border:1px solid #eef6ff;display:flex;flex-direction:column;gap:8px}
    .thumb{height:140px;border-radius:8px;background:linear-gradient(135deg,#eef2ff,#fff);display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--muted)}
    .title{font-weight:600}
    .meta{font-size:13px;color:var(--muted)}
    .price{margin-top:auto;font-weight:700}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;border:1px solid #e6edf7;font-size:12px}
    .loader{text-align:center;padding:20px;color:var(--muted)}
   
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{background:var(--card);width:100%;max-width:720px;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.3)}
    .modal .grid{grid-template-columns:1fr}
    .close{border:0;background:transparent;font-size:18px;cursor:pointer}

    @media (max-width:880px){.hero{grid-template-columns:1fr;}.hero-card{order:2}}
  </style>
</head>
<body>
  <header>
    <div class="logo">DT Demo</div>
    <div class="searchbar">
      <input id="search" placeholder="Search items, e.g. 'JavaScript course'" aria-label="Search" />
      <div class="controls">
        <select id="sort" class="select" aria-label="Sort">
          <option value="relevance">Sort: Relevance</option>
          <option value="price-asc">Price: Low → High</option>
          <option value="price-desc">Price: High → Low</option>
        </select>
        <button class="btn" id="reset">Reset</button>
      </div>
    </div>
    <button id="favBtn" title="View favorites" class="btn">Favorites</button>
  </header>

  <main>
    <section class="hero">
      <div class="hero-card">
        <h2>Dynamic listing — built with HTML, CSS, JS</h2>
        <p class="meta">This single-file demo loads items from a local JSON array (replace with your API). It supports search (debounced), category filters, sort, infinite scroll (load-more simulation), favorites (localStorage) and a detail modal.</p>

        <div class="filters" role="toolbar" aria-label="Filters">
          <div>
            <label class="meta" for="category">Category</label><br>
            <select id="category" class="select">
              <option value="all">All categories</option>
            </select>
          </div>
          <div>
            <label class="meta">Price</label><br>
            <select id="priceRange" class="select">
              <option value="any">Any</option>
              <option value="0-20">₹0 - ₹20</option>
              <option value="20-50">₹20 - ₹50</option>
              <option value="50+">₹50+</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px;">
          <button id="apply" class="btn">Apply</button>
          <button id="export" class="select">Export JSON</button>
        </div>
      </div>

      <aside class="hero-card">
        <h3>Summary</h3>
        <p class="meta">Items shown: <span id="count">0</span></p>
        <p class="meta">API-ready: yes — the script calls a fake endpoint if provided. Replace <code>fetchItems()</code> with your API call.</p>
        <hr />
        <p class="meta">Tech: HTML • CSS • Vanilla JS</p>
      </aside>
    </section>

    <section>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="loader" class="loader">Scroll down to load more...</div>
    </section>
  </main>


  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <strong id="modalTitle">Item</strong>
        <div>
          <button id="favToggle" class="chip">☆ Favorite</button>
          <button id="closeModal" class="close" aria-label="Close">✕</button>
        </div>
      </div>
      <div class="grid">
        <div style="display:flex;gap:12px;align-items:flex-start;">
          <div style="flex:1">
            <div id="modalThumb" class="thumb">Image</div>
          </div>
          <div style="flex:2">
            <p id="modalDesc" class="meta"></p>
            <p class="price" id="modalPrice"></p>
            <p class="meta">Category: <span id="modalCat"></span></p>
            <div style="margin-top:12px;display:flex;gap:8px;">
              <button id="buyNow" class="btn">Buy / Open</button>
              <button id="shareBtn" class="select">Share</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
 
  const SAMPLE_ITEMS = Array.from({length:45}).map((_,i)=>({
    id: i+1,
    title: `Sample Item ${i+1}`,
    description: `This is a short description for item ${i+1}. Useful for demo and testing dynamic behaviour.`,
    price: Number((Math.random()*120).toFixed(2)),
    category: ["Courses","Ebook","Tool","Template"][i%4],
    image: null
  }))

  
  const BATCH_SIZE = 12 


  const state = {
    all: [], 
    filtered: [],
    offset: 0,
    query: '',
    category: 'all',
    priceRange: 'any',
    sort: 'relevance',
    favorites: new Set(JSON.parse(localStorage.getItem('dtdemo.favs')||'[]'))
  }

  
  const grid = document.getElementById('grid')
  const loader = document.getElementById('loader')
  const countEl = document.getElementById('count')
  const searchInput = document.getElementById('search')
  const categorySelect = document.getElementById('category')
  const priceRange = document.getElementById('priceRange')
  const sortSelect = document.getElementById('sort')
  const applyBtn = document.getElementById('apply')
  const resetBtn = document.getElementById('reset')
  const exportBtn = document.getElementById('export')
  const favBtn = document.getElementById('favBtn')


  const modal = document.getElementById('modalBackdrop')
  const modalTitle = document.getElementById('modalTitle')
  const modalDesc = document.getElementById('modalDesc')
  const modalPrice = document.getElementById('modalPrice')
  const modalCat = document.getElementById('modalCat')
  const modalThumb = document.getElementById('modalThumb')
  const closeModal = document.getElementById('closeModal')
  const favToggle = document.getElementById('favToggle')


  function debounce(fn,ms=350){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}}


  async function fetchItems(){
  
    try{
      const res = await fetch('/api/items')
      if(res.ok){const data=await res.json();return data}
    }catch(e){/* ignore network errors in demo */}
   
    await new Promise(r=>setTimeout(r,300))
    return SAMPLE_ITEMS
  }


  async function init(){
    state.all = await fetchItems()
    populateCategoryOptions(state.all)
    applyFilters()

    createObserver()
  }

  function populateCategoryOptions(items){
    const cats = Array.from(new Set(items.map(i=>i.category))).sort()
    cats.forEach(cat=>{
      const o = document.createElement('option')
      o.value = cat
      o.textContent = cat
      categorySelect.appendChild(o)
    })
  }

  function applyFilters(){
    state.offset = 0
    const q = state.query.trim().toLowerCase()
    let list = state.all.slice()
    if(state.category !== 'all') list = list.filter(i=>i.category===state.category)
    if(q) list = list.filter(i=> (i.title+" "+i.description).toLowerCase().includes(q))
    // price range
    if(state.priceRange !== 'any'){
      if(state.priceRange === '50+') list = list.filter(i=>i.price>=50)
      else {
        const [a,b] = state.priceRange.split('-').map(Number)
        list = list.filter(i=>i.price>=a && i.price<=b)
      }
    }
    // sort
    if(state.sort === 'price-asc') list.sort((a,b)=>a.price-b.price)
    if(state.sort === 'price-desc') list.sort((a,b)=>b.price-a.price)
    state.filtered = list
    // render first batch
    grid.innerHTML = ''
    appendNextBatch()
    countEl.textContent = state.filtered.length
  }

  function appendNextBatch(){
    const start = state.offset
    const end = Math.min(state.offset + BATCH_SIZE, state.filtered.length)
    const slice = state.filtered.slice(start,end)
    slice.forEach(renderCard)
    state.offset = end
    if(state.offset >= state.filtered.length){
      loader.textContent = 'No more items.'
    } else {
      loader.textContent = 'Scroll down to load more...'
    }
  }

  function renderCard(item){
    const el = document.createElement('article')
    el.className = 'card'
    el.tabIndex = 0
    el.innerHTML = `
      <div class="thumb">${item.image?'<img src="'+item.image+'" alt="'+item.title+'" style="max-width:100%;height:100%;object-fit:cover;border-radius:8px">':'${item.category}'} </div>
      <div>
        <div class="title">${escapeHtml(item.title)}</div>
        <div class="meta">${escapeHtml(item.description.slice(0,70))}...</div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <div class="meta">${item.category}</div>
        <div class="price">₹${Number(item.price).toFixed(2)}</div>
      </div>
    `
    el.addEventListener('click',()=>openModal(item))
    // keyboard open
    el.addEventListener('keydown',e=>{if(e.key==='Enter')openModal(item)})
    grid.appendChild(el)
  }

  function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]))}


  let currentModalItem = null
  function openModal(item){
    currentModalItem = item
    modalTitle.textContent = item.title
    modalDesc.textContent = item.description
    modalPrice.textContent = '₹' + Number(item.price).toFixed(2)
    modalCat.textContent = item.category
    modalThumb.textContent = item.image ? '' : item.category
    favToggle.textContent = state.favorites.has(String(item.id)) ? '★ Favorited' : '☆ Favorite'
    modal.style.display = 'flex'
  }
  function close(){modal.style.display='none'; currentModalItem=null}
  closeModal.addEventListener('click',close)
  modal.addEventListener('click',(e)=>{if(e.target===modal)close()})

  favToggle.addEventListener('click',()=>{
    if(!currentModalItem) return
    const id = String(currentModalItem.id)
    if(state.favorites.has(id)) state.favorites.delete(id)
    else state.favorites.add(id)
    saveFavs()
    favToggle.textContent = state.favorites.has(id) ? '★ Favorited' : '☆ Favorite'
  })

  function saveFavs(){localStorage.setItem('dtdemo.favs',JSON.stringify(Array.from(state.favorites)))}

 
  favBtn.addEventListener('click',()=>{
    const arr = Array.from(state.favorites).map(id=>state.all.find(i=>String(i.id)===id)).filter(Boolean)
    if(!arr.length) return alert('No favorites yet')
   
    const lines = arr.map(a=>`${a.title} — ₹${a.price}`)
    alert('Favorites:\n\n'+lines.join('\n'))
  })


  exportBtn.addEventListener('click',()=>{
    const data = JSON.stringify(state.filtered, null, 2)
    const blob = new Blob([data],{type:'application/json'})
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url; a.download = 'export.json'
    a.click()
    URL.revokeObjectURL(url)
  })

  
  applyBtn.addEventListener('click',()=>{
    state.category = categorySelect.value
    state.priceRange = priceRange.value
    state.sort = sortSelect.value
    applyFilters()
  })

  resetBtn.addEventListener('click',()=>{
    searchInput.value = ''
    categorySelect.value = 'all'
    priceRange.value = 'any'
    sortSelect.value = 'relevance'
    state.query = ''
    state.category = 'all'
    state.priceRange = 'any'
    state.sort = 'relevance'
    applyFilters()
  })

  searchInput.addEventListener('input', debounce(e=>{
    state.query = e.target.value
    applyFilters()
  },300))

  
  function createObserver(){
    const obs = new IntersectionObserver(entries=>{
      entries.forEach(ent=>{
        if(ent.isIntersecting && state.offset < state.filtered.length){
          setTimeout(appendNextBatch, 300) 
        }
      })
    }, {root:null,rootMargin:'200px',threshold:0.1})
    obs.observe(loader)
  }

  
  window.addEventListener('keydown',e=>{ if(e.key===' ' && state.offset < state.filtered.length) appendNextBatch() })

  
  function openFromURL(){
    try{const p = new URLSearchParams(location.search); if(p.has('item')){const id = p.get('item'); const item = state.all.find(x=>String(x.id)===id); if(item) openModal(item)}}catch(e){}
  }
  window.addEventListener('keydown', e=>{ if(e.key==='Escape') close() })

  init().then(openFromURL)
  </script>
</body>
</html>
